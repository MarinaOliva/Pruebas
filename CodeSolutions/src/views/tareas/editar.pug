extends ../layouts/main

block contenido
  h1 Editar Tarea

  //- Formulario de edición de tarea
  form(action=`/tareas/editar/${tarea._id}?_method=PUT` method="POST")
    div.form-group
      label(for="nombre") Nombre de la tarea
      input.form-control(type="text" name="nombre" id="nombre" required value=tarea.nombre)

    div.form-group
      label(for="proyectoId") Proyecto
      select.form-control(name="proyectoId" id="proyectoId" required)
        each proyecto in proyectos
          //- Comparamos con _id en lugar de id
          option(value=proyecto._id selected=(tarea.proyectoId && tarea.proyectoId.toString() === proyecto._id.toString()))= proyecto.nombre

    div.form-group
      label(for="estado") Estado
      select.form-control(name="estado" id="estado" required)
        each estado in estadosValidos
          //- No mostrar "Eliminada" en el formulario de edición
          if estado !== 'Eliminada'
            option(value=estado selected=(tarea.estado === estado))= estado

    div.form-group
      label Horas Estimadas
      input.form-control(type="number" name="horasEstimadas" id="horasEstimadas" min="0" value=tarea.horasEstimadas)

    div.form-group
      label Horas Registradas
      input.form-control(type="number" name="horasRegistradas" id="horasRegistradas" min="0" value=tarea.horasRegistradas)

    div.form-group
      label Empleados asignados
      div.empleados-checkboxes
        if empleados && empleados.length > 0
          each empleado in empleados
            label.checkbox-item
              //- Comparamos con _id en lugar de id
              input(
                type="checkbox"
                name="empleadosAsignados"
                value=empleado._id
                checked=(tarea.empleadosAsignados && tarea.empleadosAsignados.some(e => e.toString() === empleado._id.toString()))
              )
              | #{empleado.nombre} (#{empleado.rol})
        else
          p No hay empleados disponibles

    button.btn.btn-primary(type="submit") Guardar Cambios
    a.btn.btn-secondary(href="/tareas") Cancelar
